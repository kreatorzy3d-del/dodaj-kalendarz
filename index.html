<!DOCTYPE html>
<html>
<head>
    <title>Dodaj mój kalendarz</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>

<h1>Dodaj mój kalendarz</h1>
<button id="authorize_button">Dodaj kalendarz</button>

<script>
    const CLIENT_ID = "306142273186-pulgqg887a0oplv02o54e0d4j0si062d.apps.googleusercontent.com";
    const API_KEY = "";
    const SCOPES = "https://www.googleapis.com/auth/calendar";

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    function gapiLoaded() {
        gapi.load("client", initializeGapiClient);
    }

    async function initializeGapiClient() {
        await gapi.client.init({
            apiKey: API_KEY,
            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
        });
        gapiInited = true;
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: handleAuth,
        });
        gisInited = true;
    }

    document.getElementById("authorize_button").onclick = () => {
        if (!gapiInited || !gisInited) return;
        tokenClient.requestAccessToken();
    };

    async function handleAuth() {
        const calendarId = "ce4cebe9ac636039f430d902b645559d5ae574e7a777b9935264010155775901@group.calendar.google.com";
        try {
            await gapi.client.calendar.calendarList.insert({
                resource: {
                    id: calendarId
                }
            });
            alert("Kalendarz został dodany!");
        } catch (err) {
            alert("Błąd: " + err.message);
        }
    }
</script>

<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

</body>
</html>
